	#include "hgimg3.as"

	bgscr 0,ginfo(20),ginfo(21),0,0,0
	cls 4
	hgini

	randomize

	#define D_MODE 1	;開発モード1で起動

	dir_home = dir_cur

	if (D_MODE == 1){ screen 1,100,100 : gsel 0 }

	ddim x,1
	ddim y,1
	ddim z,1
	ddim mx,1
	ddim my,1
	ddim mz,1
	dim obj,100
	dim model,100
	dim tex,100
	dim emodel,100
	dim eff,100

	mov = 30.0
	chdir dir_home+"/ac/"

	addxfile m_xmodel,"default.x"
	addxanim m_xmodel,"move.x"
	regobj ac, m_xmodel

	
	clscolor $FF

	chdir dir_home

	chdir dir_home+"/town/"
	addxfile m_town,"town.x"
	
	regobj obj_town, m_town


	

	;texload dir_home+"/image/floor/01.jpg" : tex(0) = stat
	;addmesh model(0),4,4,16,300,300,tex
	;regobj obj(0),model(0)
	;setpos obj(0),0,0,0

	x = 0.0 : y = -100.0 : z = 0.0
	walkc = 1.0
	ww = 0.0

	mouse ginfo(20)/2,ginfo(21)/2
	mouse -1 : mouse -1

	setefx HGOBJ_CAMERA,M_PI/4,10,100000

*main
	stick key,$3ff
	if key&128 : goto *owari

	;ary = double(ginfo(20)/2-mousex)/1000
	;arx = 0.0
	;if (((crx < M_PI/4) & (mousey < ginfo(21)/2)) | ((crx > -M_PI/4) & (mousey > ginfo(21)/2))){
	;	arx = double(ginfo(21)/2-mousey)/1000
	;}

	;mouse ginfo(20)/2,ginfo(21)/2
	;mouse -1

	;addang HGOBJ_CAMERA, arx,ary
	setpos ac,x,y,z
	setpos HGOBJ_CAMERA, x+sin(cry)*4000,y-1500,z+cos(cry)*4000
	getang HGOBJ_CAMERA, crx,cry,crz

	mx = 0.0 :  my = 0.0 : mz = 0.0
	getkey up,'W'
	if (up == 1){
		mx -= sin(cry)*mov : mz -= cos(cry)*mov
		if (anim == 0){ objact ac,0,0 }
		anim++
	} else {
		objact ac,-1,0
		anim = 0
	}
	getkey dw,'S'
	if (dw == 1){ mx += sin(cry)*mov : mz += cos(cry)*mov }
	getkey ri,'D'
	;if (ri == 1){ mx += cos(cry)*mov : mz -= sin(cry)*mov }
	if (ri == 1){
		addang HGOBJ_CAMERA, ,-0.01
		addang ac,,-0.01
	}
	getkey le,'A'
	;if (le == 1){ mx -= cos(cry)*mov : mz += sin(cry)*mov }
	if (le == 1){
		addang HGOBJ_CAMERA, ,0.01
		addang ac,,0.01
	}
	getkey un,'Q'
	if (un == 1){ my += mov }
	getkey ov,'E'
	if (ov == 1){ my -= mov }

	getkey ds,16
	x += mx*(1+ds*2) : y += my*(1+ds*2) : z += mz*(1+ds*2)

	if (y > 0){ y = -1.0 }

	hgdraw				; 描画

	hgsync 10			; 時間待ち


	gsel 1
	cls
	gsel 0

	goto *main

*owari
	end
